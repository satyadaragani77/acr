<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Understand access to a connected registry | Azure Container Registry</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Introduction to token-based authentication and authorization for connected registries in Azure Container Registry">
    
    <link rel="preload" href="/acr/assets/css/0.styles.141b3060.css" as="style"><link rel="preload" href="/acr/assets/js/app.8af8dec3.js" as="script"><link rel="preload" href="/acr/assets/js/2.f86faad7.js" as="script"><link rel="preload" href="/acr/assets/js/29.0580cb25.js" as="script"><link rel="prefetch" href="/acr/assets/js/10.57bcffaa.js"><link rel="prefetch" href="/acr/assets/js/11.d70faeba.js"><link rel="prefetch" href="/acr/assets/js/12.21fd10c0.js"><link rel="prefetch" href="/acr/assets/js/13.7c48beb6.js"><link rel="prefetch" href="/acr/assets/js/14.2df334c1.js"><link rel="prefetch" href="/acr/assets/js/15.d2d3bd05.js"><link rel="prefetch" href="/acr/assets/js/16.83754447.js"><link rel="prefetch" href="/acr/assets/js/17.532f23a0.js"><link rel="prefetch" href="/acr/assets/js/18.a76e8f7c.js"><link rel="prefetch" href="/acr/assets/js/19.5768f810.js"><link rel="prefetch" href="/acr/assets/js/20.ab152cd6.js"><link rel="prefetch" href="/acr/assets/js/21.39ae3273.js"><link rel="prefetch" href="/acr/assets/js/22.e112ad54.js"><link rel="prefetch" href="/acr/assets/js/23.c753305d.js"><link rel="prefetch" href="/acr/assets/js/24.6a571862.js"><link rel="prefetch" href="/acr/assets/js/25.e3748106.js"><link rel="prefetch" href="/acr/assets/js/26.3c2e1ed6.js"><link rel="prefetch" href="/acr/assets/js/27.69f0c3fe.js"><link rel="prefetch" href="/acr/assets/js/28.a9c9745b.js"><link rel="prefetch" href="/acr/assets/js/3.e0486cc8.js"><link rel="prefetch" href="/acr/assets/js/30.789339f0.js"><link rel="prefetch" href="/acr/assets/js/31.ac7460c2.js"><link rel="prefetch" href="/acr/assets/js/32.cccb17c6.js"><link rel="prefetch" href="/acr/assets/js/33.c276ba67.js"><link rel="prefetch" href="/acr/assets/js/34.278f0e8f.js"><link rel="prefetch" href="/acr/assets/js/35.8a7cb580.js"><link rel="prefetch" href="/acr/assets/js/36.3eb07688.js"><link rel="prefetch" href="/acr/assets/js/37.5d7ff385.js"><link rel="prefetch" href="/acr/assets/js/38.35e36b4f.js"><link rel="prefetch" href="/acr/assets/js/39.f8764d22.js"><link rel="prefetch" href="/acr/assets/js/4.8afd7a30.js"><link rel="prefetch" href="/acr/assets/js/40.58758a47.js"><link rel="prefetch" href="/acr/assets/js/41.c5cdf429.js"><link rel="prefetch" href="/acr/assets/js/42.132a6a36.js"><link rel="prefetch" href="/acr/assets/js/43.2348c5ac.js"><link rel="prefetch" href="/acr/assets/js/44.b256bf82.js"><link rel="prefetch" href="/acr/assets/js/45.91177548.js"><link rel="prefetch" href="/acr/assets/js/46.ef372030.js"><link rel="prefetch" href="/acr/assets/js/47.2df2bbed.js"><link rel="prefetch" href="/acr/assets/js/48.2501e4d2.js"><link rel="prefetch" href="/acr/assets/js/49.608bc551.js"><link rel="prefetch" href="/acr/assets/js/5.2f834d0b.js"><link rel="prefetch" href="/acr/assets/js/6.d3786eb9.js"><link rel="prefetch" href="/acr/assets/js/7.d373db68.js"><link rel="prefetch" href="/acr/assets/js/8.830cfc3e.js"><link rel="prefetch" href="/acr/assets/js/9.c8fd7778.js">
    <link rel="stylesheet" href="/acr/assets/css/0.styles.141b3060.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/acr/" class="home-link router-link-active"><img src="/acr/files/acr.svg" alt="Azure Container Registry" class="logo"> <span class="site-name can-hide">Azure Container Registry</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/acr/" aria-current="page" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/acr/#blog-posts" class="sidebar-link">Blog posts</a></li><li class="sidebar-sub-header"><a href="/acr/#links" class="sidebar-link">Links</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Teleport</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tasks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Authentication</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integration</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="understand-access-to-a-connected-registry"><a href="#understand-access-to-a-connected-registry" class="header-anchor">#</a> Understand access to a connected registry</h1> <p>To access and manage a <a href="/acr/preview/connected-registry/intro-connected-registry.html">connected registry</a>, currently only ACR <a href="/acr/preview/connected-registry/container-registry-repository-scoped-permissions.html">token-based authentication</a> is supported. As shown in the following image, two different types of tokens are used by each connected registry:</p> <ul><li>One or more <em>client tokens</em>, which on-premise clients use to authenticate with a connected registry and push or pull images and artifacts to or from it.</li> <li>A <em>sync token</em> used by each connected registry to access its parent and synchronize images and artifacts with it.</li></ul> <p><img src="media/connected-registry/connected-registry-authentication-overview.svg" alt="Connected Registry Authentication Overview"></p> <blockquote><p>[!IMPORTANT]
Store token passwords for each connected registry in a safe location. After they are created, token passwords can't be retrieved. You can regenerate token passwords at any time.</p></blockquote> <h2 id="client-tokens"><a href="#client-tokens" class="header-anchor">#</a> Client tokens</h2> <p>To manage client access to a connected registry, you create tokens scoped for actions on one or more repositories. After creating a token, you configure the connected registry to accept the token by using the <code>az acr connected-registry update</code> command. A client can then use the token credentials to access a connected registry endpoint - for example, to use Docker CLI commands to pull or push images to the connected registry.</p> <p>Your options for configuring client token actions depend on whether the connected registry allows both push and pull operations or functions as a pull-only mirror.</p> <ul><li>A connected registry in the default <em>registry</em> mode allows both pull and push operations, so you can create a token that allows actions to both <em>read</em> and <em>write</em> repository content in that registry.</li> <li>For a connected registry in <em>mirror</em> mode, client tokens can only allow actions to <em>read</em> repository content.</li></ul> <h3 id="manage-client-tokens"><a href="#manage-client-tokens" class="header-anchor">#</a> Manage client tokens</h3> <p>Update client tokens, passwords, or scope maps as needed by using <a href="/cli/az/acr#az_acr_token">az acr token</a> and <a href="/cli/az/acr#az_acr_scope-map">az acr scope-map</a> commands. Client token updates are propagated automatically to the connected registries that accept the token.</p> <h2 id="sync-token"><a href="#sync-token" class="header-anchor">#</a> Sync token</h2> <p>Each connected registry uses a <em>sync token</em> to authenticate with its parent - which could be another connected registry or the cloud registry. The connected registry automatically uses this token when synchronizing content with the parent or performing other updates.</p> <ul><li>The <em>sync token</em> is generated automatically when you create the connected registry resource. You must run the <a href="https://docs.microsoft.com/cli/azure/acr/connected-registry/install?view=azure-cli-latest#az_acr_connected_registry_install_renew_credentials" target="_blank" rel="noopener noreferrer">az acr connected-registry install renew-credentials<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> command to generate the passwords.</li> <li>Include the <em>sync token</em> credentials in the configuration used to deploy the connected registry on premises.</li> <li>By default, the <em>sync token</em> is granted permission to synchronize selected repositories with its parent. You must provide existing <em>sync token</em> or one or more repositories to sync when you create the connected registry resource.</li> <li>It also has permissions to <em>read</em> and <em>write</em> synchronization messages on a gateway used to communicate with the connected registry parent. These messages control the synchronization schedule and manage other updates between the connected registry and its parent.</li></ul> <h3 id="manage-sync-token"><a href="#manage-sync-token" class="header-anchor">#</a> Manage sync token</h3> <p>Update sync tokens, passwords, or scope maps as needed by using <a href="/cli/az/acr#az_acr_token">az acr token</a> and <a href="/cli/az/acr#az_acr_scope-map">az acr scope-map</a> commands. Sync token updates are propagated automatically to the connected registry. Follow the standard practices of rotating passwords when updating the sync token.</p> <blockquote><p>[!WARNING]
Take care not to delete a sync token. Doing so will permanently prevent communication with the corresponding connected registry. You can disable a connected registry by setting the status of the sync token to <code>disabled</code>.</p></blockquote> <h2 id="registry-endpoints"><a href="#registry-endpoints" class="header-anchor">#</a> Registry endpoints</h2> <p>Token credentials for connected registies are scoped to access specific registry endpoints.</p> <p>A client token accesses the connected registry's endpoint. The connected registry endpoint is the login server URI, which is typically the IP address of the server or device that hosts it.</p> <p>A sync token accesses the endpoint of the parent registry, which is either another connected registry endpoint or the cloud registry itself. When scoped to access the cloud registry, the sync token needs to reach two registry endpoints:</p> <ul><li>The fully qualified login server name, for example, <code>contoso.azurecr.io</code>. This endpoint is used for authentication.</li> <li>A fully qualified regional <a href="https://docs.microsoft.com/azure/container-registry/container-registry-firewall-access-rules#enable-dedicated-data-endpoints" target="_blank" rel="noopener noreferrer">data endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for the cloud registry, for example, <code>contoso.westus2.data.azurecr.io</code>. This endpoint is used to exchange messages with the connected registry for synchronization purposes.</li></ul> <h2 id="next-steps"><a href="#next-steps" class="header-anchor">#</a> Next steps</h2> <p>Continue to the one of the following articles to learn about specific scenarios where connected registry can be utilized.</p> <blockquote><p><a href="/acr/preview/connected-registry/overview-connected-registry-and-iot-edge.html">Overview: Connected registry and IoT Edge</a></p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azure/acr/edit/master/docs/preview/connected-registry/overview-connected-registry-access.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/acr/assets/js/app.8af8dec3.js" defer></script><script src="/acr/assets/js/2.f86faad7.js" defer></script><script src="/acr/assets/js/29.0580cb25.js" defer></script>
  </body>
</html>
